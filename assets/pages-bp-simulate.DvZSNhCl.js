import{at as e,r as a,f as l,as as t,y as o,o as n,h as i,a as s,w as c,b as r,z as u,F as d,j as p,t as m,k as h,n as v,s as y,aw as f,ax as b,u as g,au as P,d as k}from"./index-eG3JJ1tq.js";import{t as x,_,u as C}from"./hook.B6BOhojZ.js";import{a as N}from"./utils.BcgAbc3K.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=N((async()=>new e.Query("Hero").limit(1e3).find().then((e=>e.map((e=>e.toJSON()))))),6e4),S=w({__name:"HeroSelector",props:{modelValue:Array,maxSelection:{type:Number,default:5}},emits:["update:modelValue"],setup(e,{expose:b,emit:g}){const P=e,k=g,C=a(!1),N=a([...P.modelValue]),w=a([]),S=a(Object.keys(x).map((e=>{const a=x[e];return{...a,canEffectTogether:a.canEffectTogether,matchKey:a.matchKey,data:a.data,name:e,effectTogether:!1,collapsed:!1}}))),T=l((()=>{let e=w.value;const a=N.value.map((e=>e.heroName));return e=e.filter((e=>!a.includes(e.heroName))),S.value.forEach((a=>{const l=a.name,t=x[l].matchKey,o=a.data.filter((e=>e.active)).map((e=>e.name));o.length&&(e=e.filter((e=>{var l;let n=null==(l=e[t])?void 0:l.split(/[,，]/).map((e=>e.trim()));return a.effectTogether?0===_.difference(o,n).length:_.intersection(n,o).length})))})),e}));function $(){k("update:modelValue",N.value),C.value=!1}function j(){C.value=!1}return t((async()=>{w.value=await V()})),b({showHeroSelector:()=>{C.value=!0}}),(a,l)=>{const t=o("el-button"),b=o("el-dialog");return n(),i(d,null,[s(t,{onClick:l[0]||(l[0]=e=>C.value=!0)},{default:c((()=>[r("选择英雄")])),_:1}),s(b,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value=e),title:"选择英雄",width:"80%",top:"5vh",onClose:j},{default:c((()=>[u("div",{style:{height:"80vh",display:"flex","flex-direction":"column"}},[u("div",{flex:"cross:top","flex-box":"1",style:{height:"calc(100% - 60px)"}},[u("div",{"flex-box":"0",style:{width:"400px",height:"100%","overflow-y":"auto"}},[(n(!0),i(d,null,p(S.value,((e,a)=>(n(),i("div",{key:a,class:"filter-section"},[u("div",{class:"filter-header",onClick:e=>function(e){S.value[e].collapsed=!S.value[e].collapsed}(a)},[u("span",null,m(e.label),1),u("span",null,m(e.collapsed?"展开":"折叠"),1)],8,["onClick"]),e.collapsed?y("",!0):(n(),i("div",{key:0,class:"list-box rarity mt_16"},[(n(!0),i(d,null,p(e.data,((a,l)=>(n(),i("div",{onClick:e=>function(e){e.active=!e.active}(a),key:l,class:h([{active:a.active},"item"]),style:v(e.customStyle)},[u("img",{src:a.src,alt:""},null,8,["src"])],14,["onClick"])))),128)),e.canEffectTogether?(n(),i("div",{key:0,class:h(["item effect-together",{active:e.effectTogether}]),onClick:a=>function(e){e.effectTogether=!e.effectTogether}(e)}," 是否组合生效 ",10,["onClick"])):y("",!0)]))])))),128))]),u("div",{"flex-box":"1",class:"ml_16",style:{"overflow-y":"auto",height:"100%"}},[u("div",{class:"selected-heroes"},[u("h3",null,"已选择的英雄"),s(f,{name:"fade-up",tag:"div"},{default:c((()=>[(n(!0),i(d,null,p(N.value,((e,a)=>(n(),i("div",{onClick:e=>function(e,a){N.value.splice(a,1)}(0,a),class:"hero-item",key:e.heroName},[u("img",{style:{width:"40px",height:"40px"},src:e.logo,alt:""},null,8,["src"])],8,["onClick"])))),128))])),_:1})]),u("div",null,[u("h3",null,"英雄池"),s(f,{name:"fade-down",tag:"div",flex:"cross:top",style:{"flex-wrap":"wrap",gap:"8px","align-items":"flex-start"}},{default:c((()=>[(n(!0),i(d,null,p(T.value,((a,l)=>{return n(),i("div",{class:h(["hero-item",{"selected-hero":(t=a,N.value.some((e=>e.heroName===t.heroName))),disabled:N.value.length>=e.maxSelection}]),key:a.heroName,onClick:e=>function(e){const a=N.value.findIndex((a=>a.heroName===e.heroName));-1!==a?N.value.splice(a,1):N.value.length<P.maxSelection&&N.value.push(e)}(a)},[u("img",{style:{width:"40px",height:"40px"},src:a.logo,alt:""},null,8,["src"])],10,["onClick"]);var t})),128))])),_:1})])])]),u("div",{"flex-box":"0",class:"mt_16"},[s(t,{onClick:j},{default:c((()=>[r("取消")])),_:1}),s(t,{type:"primary",onClick:$},{default:c((()=>[r("确认")])),_:1})])])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-6162ce12"]]),T=w({__name:"bp-simulate",setup(e){const a=C("langrissar-calculator-bp-simulate-heroPool1P",[]),v=C("langrissar-calculator-bp-simulate-heroPool2P",[]),f=()=>{x.splice(0,x.length,...a.value.map(((e,a)=>({id:`1P_${a+1}`,heroName:e.heroName,logo:e.logo,status:"available"})))),_.splice(0,_.length,...v.value.map(((e,a)=>({id:`2P_${a+1}`,heroName:e.heroName,logo:e.logo,status:"available"}))))};t((()=>{f()}));const x=b(Array.from({length:15},((e,a)=>({id:`1P_${a+1}`,heroName:`1P英雄${a+1}`,logo:`https://placekitten.com/80/80?image=${a+1}`,status:"available"})))),_=b(Array.from({length:15},((e,a)=>({id:`2P_${a+16}`,heroName:`2P英雄${a+1}`,logo:`https://placekitten.com/80/80?image=${a+16}`,status:"available"})))),N=b({turn:1,actionSequence:[{player:"2P",action:"ban"},{player:"1P",action:"ban"},{player:"1P",action:"pick"},{player:"2P",action:"ban"},{player:"2P",action:"ban"},{player:"2P",action:"pick"},{player:"1P",action:"ban"},{player:"1P",action:"ban"},{player:"1P",action:"pick"},{player:"2P",action:"ban"},{player:"2P",action:"ban"},{player:"2P",action:"pick"},{player:"1P",action:"ban"},{player:"1P",action:"ban"},{player:"1P",action:"pick"},{player:"2P",action:"ban"},{player:"2P",action:"ban"},{player:"2P",action:"pick"},{player:"1P",action:"ban"},{player:"1P",action:"ban"},{player:"1P",action:"pick"},{player:"2P",action:"ban"},{player:"2P",action:"ban"},{player:"2P",action:"pick"},{player:"1P",action:"ban"},{player:"1P",action:"ban"},{player:"1P",action:"pick"},{player:"2P",action:"pick"}],history:[]}),w=l((()=>N.actionSequence[N.turn-1])),V=e=>{const a=w.value;if(!a)return!1;const l="ban"===a.action&&e!==a.player,t="pick"===a.action&&e===a.player;return l||t},T=(e,a)=>{if(!V(a)||"available"!==e.status)return;const l=w.value;"ban"===l.action?e.status="disabled":"pick"===l.action&&(e.status="selected"),N.history.push({turn:N.turn,heroId:e.id,status:e.status}),N.turn++},$=()=>{if(1===N.turn)return;const e=N.history.pop();if(!e)return;const{heroId:a,status:l}=e,t=[...x,..._].find((e=>e.id===a));t&&(t.status="available"),N.turn--},j=l((()=>{var e;return(null==(e=w.value)?void 0:e.player)||""})),I=l((()=>{const e=w.value;return e?"ban"===e.action?"禁用对手英雄":"选择自己的英雄":""}));return(e,l)=>{const t=o("el-button"),b=k;return n(),i(d,null,[u("div",null,[u("div",null,[r(" 1P:"),s(S,{modelValue:g(a),"onUpdate:modelValue":l[0]||(l[0]=e=>P(a)?a.value=e:null),maxSelection:15},null,8,["modelValue"])]),u("div",null,[r(" 2P:"),s(S,{modelValue:g(v),"onUpdate:modelValue":l[1]||(l[1]=e=>P(v)?v.value=e:null),maxSelection:15},null,8,["modelValue"])]),s(t,{type:"primary",onClick:f},{default:c((()=>[r("初始化BP")])),_:1})]),u("div",{class:"hero-simulator mt_16"},[u("div",{class:"main-layout"},[u("div",{class:"hero-section"},[u("h3",null,"1P 英雄池"),u("div",{class:"heroes"},[(n(!0),i(d,null,p(x,((e,a)=>(n(),i("div",{key:e.heroName,class:h(["hero",{disabled:"disabled"===e.status,selected:"selected"===e.status}]),onClick:a=>T(e,"1P")},[u("img",{src:e.logo,alt:e.heroName},null,8,["src","alt"])],10,["onClick"])))),128))]),V("1P")?y("",!0):(n(),i("div",{key:0,class:"overlay"},[u("span",null,"请稍候...")]))]),u("div",{class:"action-info"},[u("h2",null,"当前操作"),u("p",null,m(j.value)+" 回合 - "+m(I.value),1),s(b,{onClick:$,disabled:1===N.turn},{default:c((()=>[r("撤销上一步")])),_:1},8,["disabled"])]),u("div",{class:"hero-section"},[u("h3",null,"2P 英雄池"),u("div",{class:"heroes"},[(n(!0),i(d,null,p(_,((e,a)=>(n(),i("div",{key:e.heroName,class:h(["hero",{disabled:"disabled"===e.status,selected:"selected"===e.status}]),onClick:a=>T(e,"2P")},[u("img",{src:e.logo,alt:e.heroName},null,8,["src","alt"])],10,["onClick"])))),128))]),V("2P")?y("",!0):(n(),i("div",{key:0,class:"overlay"},[u("span",null,"请稍候...")]))])])])],64)}}},[["__scopeId","data-v-6ea3d881"]]);export{T as default};
